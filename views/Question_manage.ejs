<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>å•é¡Œç®¡ç†ãƒšãƒ¼ã‚¸</title>
        <link href="/stylesheets/Question_manage.css" rel="stylesheet">
        <style>
            /* ã“ã“ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨˜è¿° */
        </style>
    </head>

<body>
<script src="/socket.io/socket.io.js"></script>

<div class="header">
    <h1>å•é¡Œç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
</div>


    <div>
        <button id="add-button" class="button">æ–°è¦ä½œæˆ</button>
        <button id="delete-button" type="submit" class="button">é¸æŠã—ãŸå•é¡Œã®å‰Šé™¤</button>
        <button  id="edit-button" class="button">é¸æŠã—ãŸå•é¡Œã®ç·¨é›†</button>
        <input type="text" id="search-box" placeholder="æ¤œç´¢..." class="search-box">
        <button id="search-button" class="search-button">ğŸ”</button>
    </div> 
    <form id="select-form">   
    <table>
        <tr>
            <th>é¸æŠ</th>
            <th>è³‡æ ¼å</th>
            <th>ã‚¸ãƒ£ãƒ³ãƒ«</th>
            <th>å¹´åº¦</th>
            <th>å•é¡Œå</th>
            <th>å•é¡Œæ–‡</th>
            <th>é¸æŠè‚¢1</th>
            <th>é¸æŠè‚¢2</th>
            <th>é¸æŠè‚¢3</th>
            <th>é¸æŠè‚¢4</th>
            <th>å†™çœŸå</th>
            <th>å›ç­”å½¢å¼</th>
        </tr>
        <% questions.forEach(function(question,index) { %>
            <tr>
                <td> <input type="radio" name="select" value="<%= question.user_ID %>" 
                    data-qualification_name="<%= question.qualification_name %>" 
                    data-question_genre="<%= question.question_genre %>"
                    data-question_years="<%= question.question_years %>"
                    data-question_years="<%= question.question_name %>"
                    data-question_text="<%= question.question_text %>"
                    data-select_1="<%= question.select_1 %>"
                    data-select_2="<%= question.select_2 %>"
                    data-select_3="<%= question.select_3 %>"
                    data-select_4="<%= question.select_4 %>"
                    data-pics_name="<%= question.pics_name %>"
                    data-type_name="<%= question.type_name %>"></td>
                <td class="ellipsis" onclick="toggleText(this)"><%= question.qualification_name %></td>
                <td class="ellipsis" onclick="toggleText(this)"><%= question.question_genre %></td>
                <td class="ellipsis" onclick="toggleText(this)"><%= question.question_years %></td>
                <td class="ellipsis" onclick="toggleText(this)"><%= question.question_name %></td> 
                <td class="ellipsis" onclick="toggleText(this)"><%= question.question_text %></td> 
                <td class="ellipsis" onclick="toggleText(this)"><%= question.select_1 %></td> 
                <td class="ellipsis" onclick="toggleText(this)"><%= question.select_2 %></td> 
                <td class="ellipsis" onclick="toggleText(this)"><%= question.select_3 %></td> 
                <td class="ellipsis" onclick="toggleText(this)"><%= question.select_4 %></td> 
                <td class="ellipsis" onclick="toggleText(this)"><%= question.pics_name %></td>
                <td class="ellipsis" onclick="toggleText(this)"><%= question.type_name %></td> 
            </tr>
        <% }); %>
    </table>
</form>

<a href="/mondai">å•é¡Œå‡ºé¡Œ</a>
<script>
    var socket = io();
    document.getElementById('select-form').addEventListener('submit', function(event) {
        event.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€ä¿¡ã‚’é˜²æ­¢
        window.location.href='/main?name=teacher'
    });

    document.getElementById('add-button').addEventListener('click', function() {
        window.location.href='/account_addition'
    });

    document.getElementById('edit-button').addEventListener('click', function() {
        var selectedRadio = document.querySelector('input[name="select"]:checked');
        if (selectedRadio) {
            var selectedData = {
                userID: selectedRadio.getAttribute('data-user-id'),
                userName: selectedRadio.getAttribute('data-user-name'),
                password: selectedRadio.getAttribute('data-password'),
                logTime: selectedRadio.getAttribute('data-log-time')
            };
            var queryParams = 'userID=' + encodeURIComponent(selectedData.userID) +
              '&userName=' + encodeURIComponent(selectedData.userName) +
              '&password=' + encodeURIComponent(selectedData.password);
            window.location.href='/account_edit?' + queryParams;
        } else {
            alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        }
    });

    // å‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.getElementById('delete-button').addEventListener('click', function() {
        var selectedRadio = document.querySelector('input[name="select"]:checked');
        if (selectedRadio) {
            var user_ID = selectedRadio.getAttribute('data-user-id')
            socket.emit('account_delete',user_ID);
        } else {
            alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        }
    });

    socket.on('delete_complete',function(){
        window.location.href='/account_list';
    })

    document.getElementById('search-button').addEventListener('click', function() {
        var searchTerm = document.getElementById('search-box').value;
        socket.emit('search_accounts', searchTerm);
    });

    socket.on('search_results', function(results) {
        updateTable(results);
    });

    function updateTable(data) {
        var tbody = document.querySelector('#select-form tbody');
        tbody.innerHTML = ''; // ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¾åœ¨ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢

        // æ–°ã—ã„è¡Œã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ 
        data.forEach(function(question, index) {
            var tr = document.createElement('tr');

            tr.innerHTML = `
                <td><input type="radio" name="select" value="${question.user_ID}" 
                    data-user-id="${question.user_ID}" 
                    data-user-name="${question.user_name}"
                    data-password="${question.password}"
                    data-log-time="${question.log_time}"></td>
                <td>${question.user_ID}</td>
                <td>${question.user_name}</td>
                <td>${question.password}</td>
                <td>${new Date(question.log_time).toLocaleString('ja-JP')}</td>`;

            tbody.appendChild(tr);
        });
    }
    
    function toggleText(element) {
        // ç¾åœ¨ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯
        if (element.classList.contains('ellipsis')) {
            // ellipsisã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã¦å…¨æ–‡ã‚’è¡¨ç¤º
            element.classList.remove('ellipsis');
        } else {
            // ellipsisã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’çœç•¥
            element.classList.add('ellipsis');
        }
    }
</script>
</body>
</html>
